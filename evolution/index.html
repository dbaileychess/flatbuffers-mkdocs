
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://dbaileychess.github.io/flatbuffers-mkdocs/evolution/">
      
      
        <link rel="prev" href="../schema/">
      
      
        <link rel="next" href="../grammar/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>Evolution - FlatBuffers Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#evolution" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="FlatBuffers Docs" class="md-header__button md-logo" aria-label="FlatBuffers Docs" data-md-component="logo">
      
  <img src="../assets/flatbuffers_logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FlatBuffers Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Evolution
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="FlatBuffers Docs" class="md-nav__button md-logo" aria-label="FlatBuffers Docs" data-md-component="logo">
      
  <img src="../assets/flatbuffers_logo.svg" alt="logo">

    </a>
    FlatBuffers Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Compiler (flatc)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Compiler (flatc)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../building/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flatc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Schema (.fbs)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Schema (.fbs)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../schema/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Evolution
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Evolution
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rules" class="md-nav__link">
    <span class="md-ellipsis">
      Rules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#addition" class="md-nav__link">
    <span class="md-ellipsis">
      Addition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removal" class="md-nav__link">
    <span class="md-ellipsis">
      Removal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#name-changes" class="md-nav__link">
    <span class="md-ellipsis">
      Name Changes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#table-evolution" class="md-nav__link">
    <span class="md-ellipsis">
      Table Evolution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#union-evolution" class="md-nav__link">
    <span class="md-ellipsis">
      Union Evolution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#version-control" class="md-nav__link">
    <span class="md-ellipsis">
      Version Control
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../grammar/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Grammar
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rules" class="md-nav__link">
    <span class="md-ellipsis">
      Rules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#addition" class="md-nav__link">
    <span class="md-ellipsis">
      Addition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removal" class="md-nav__link">
    <span class="md-ellipsis">
      Removal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#name-changes" class="md-nav__link">
    <span class="md-ellipsis">
      Name Changes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#table-evolution" class="md-nav__link">
    <span class="md-ellipsis">
      Table Evolution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#union-evolution" class="md-nav__link">
    <span class="md-ellipsis">
      Union Evolution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#version-control" class="md-nav__link">
    <span class="md-ellipsis">
      Version Control
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="evolution">Evolution</h1>
<p>FlatBuffers enables the <a href="../schema/">schema</a> to evolve over time while still
maintaining forwards and backwards compatibility with old flatbuffers.</p>
<p>Some rules must be followed to ensure the evolution of a schema is valid.</p>
<h2 id="rules">Rules</h2>
<p>Adding new tables, vectors, structs to the schema is always allowed. Its only
when you add a new field to a <a href="../schema/#tables"><code>table</code></a> that certain rules
must be followed.</p>
<h3 id="addition">Addition</h3>
<p><strong>New fields MUST be added to the end of the table definition.</strong></p>
<p>This allows older data to still be read correctly (giving you the default value
of the added field if accessed).</p>
<p>Older code will simply ignore the new field in the flatbuffer.</p>
<div class="admonition tip">
<p class="admonition-title">Use <code>id</code> attributes</p>
<p>You can ignore this rule if you use the <code>id</code> attribute on all the fields of a table. This</p>
</div>
<h3 id="removal">Removal</h3>
<p><strong>You MUST not remove a field from the schema, even if you don't use it
anymore.</strong> You simply stop writing them to the buffer.</p>
<p>Its encouraged to mark the field deprecated by adding the <code>deprecated</code>
attribute. This will skip the generation of accessors and setters in the code,
to enforce the field not to be used any more.</p>
<h3 id="name-changes">Name Changes</h3>
<p>Its generally OK to change the name of tables and fields, as these are not
serialized to the buffer. It may break code that would have to be refactored
with the updated name.</p>
<h2 id="examples">Examples</h2>
<p>The following examples uses a base schema and attempts to evolve it a few times.
The versions are tracked by <code>V1</code>, <code>V2</code>, etc.. and <code>CodeV1</code> means code compiled
against the <code>V1</code> schema.</p>
<h3 id="table-evolution">Table Evolution</h3>
<p>Lets start with a simple table <code>T</code> with two fields.</p>
<div class="highlight"><span class="filename">Schema V1</span><pre><span></span><code><span class="n">table</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">a</span><span class="p">:</span><span class="kt">int</span><span class="p">;</span>
<span class="w">  </span><span class="nl">b</span><span class="p">:</span><span class="kt">int</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="1:7"><input checked="checked" id="well-evolved" name="__tabbed_1" type="radio" /><input id="improper-addition" name="__tabbed_1" type="radio" /><input id="improper-deletion" name="__tabbed_1" type="radio" /><input id="proper-reordering" name="__tabbed_1" type="radio" /><input id="changing-types" name="__tabbed_1" type="radio" /><input id="changing-defaults" name="__tabbed_1" type="radio" /><input id="renaming-fields" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="well-evolved">Well Evolved</label><label for="improper-addition">Improper Addition</label><label for="improper-deletion">Improper Deletion</label><label for="proper-reordering">Proper Reordering</label><label for="changing-types">Changing Types</label><label for="changing-defaults">Changing Defaults</label><label for="renaming-fields">Renaming Fields</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>First lets extend the table with a new field.</p>
<div class="highlight"><span class="filename">Schema V2</span><pre><span></span><code><span class="n">table</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">a</span><span class="p">:</span><span class="kt">int</span><span class="p">;</span>
<span class="w">  </span><span class="nl">b</span><span class="p">:</span><span class="kt">int</span><span class="p">;</span>
<span class="w">  </span><span class="nl">c</span><span class="p">:</span><span class="kt">int</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>This is OK. <code>CodeV1</code> reading <code>V2</code> data will simply ignore the presence of the
new field <code>c</code>. <code>CodeV2</code> reading <code>V1</code> data will get a default value (0) when
reading <code>c</code>.</p>
<div class="highlight"><span class="filename">Schema V3</span><pre><span></span><code><span class="n">table</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">a</span><span class="p">:</span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="n">deprecated</span><span class="p">);</span>
<span class="w">  </span><span class="nl">b</span><span class="p">:</span><span class="kt">int</span><span class="p">;</span>
<span class="w">  </span><span class="nl">c</span><span class="p">:</span><span class="kt">int</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>This is OK, removing field <code>a</code> via deprecation. <code>CodeV1</code>, <code>CodeV2</code> and <code>CodeV3</code>
reading <code>V3</code> data will now always get the default value of <code>a</code>, since it is not
present. <code>CodeV3</code> cannot write <code>a</code> anymore. <code>CodeV3</code> reading old data (<code>V1</code> or
<code>V2</code>) will not be able to access the field anymore, since no generated accessors
are omitted.</p>
</div>
<div class="tabbed-block">
<p>Add a new field, but this time at the beginning.</p>
<div class="highlight"><span class="filename">Schema V2</span><pre><span></span><code><span class="n">table</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">c</span><span class="p">:</span><span class="kt">int</span><span class="p">;</span>
<span class="w">  </span><span class="nl">a</span><span class="p">:</span><span class="kt">int</span><span class="p">;</span>
<span class="w">  </span><span class="nl">b</span><span class="p">:</span><span class="kt">int</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>This is NOT OK, as it makes <code>V2</code> incompatible. <code>CodeV1</code> reading <code>V2</code> data
will access <code>a</code> but will read <code>c</code> data.</p>
<p><code>CodeV2</code> reading <code>V1</code> data will access <code>c</code> but will read <code>a</code> data.</p>
</div>
<div class="tabbed-block">
<p>Remove a field from the schema.</p>
<div class="highlight"><span class="filename">Schema V2</span><pre><span></span><code><span class="n">table</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">b</span><span class="p">:</span><span class="kt">int</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>This is NOT OK. <code>CodeV1</code> reading <code>V2</code> data will access <code>a</code> but read <code>b</code> data.</p>
<p><code>CodeV2</code> reading <code>V1</code> data will access <code>b</code> but will read <code>a</code> data.</p>
</div>
<div class="tabbed-block">
<p>Lets add a new field to the beginning, but use <code>id</code> attributes.</p>
<div class="highlight"><span class="filename">Schema V2</span><pre><span></span><code><span class="n">table</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">c</span><span class="p">:</span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="o">:</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="nl">a</span><span class="p">:</span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="nl">b</span><span class="p">:</span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>This is OK. This adds the a new field in the beginning, but because all the
<code>id</code> attributes were added, it is OK.</p>
</div>
<div class="tabbed-block">
<p>Let change the types of the fields.</p>
<div class="highlight"><span class="filename">Schema V2</span><pre><span></span><code><span class="n">table</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">a</span><span class="p">:</span><span class="n">uint</span><span class="p">;</span>
<span class="w">  </span><span class="nl">b</span><span class="p">:</span><span class="n">uint</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>This is MAYBE OK, and only in the case where the type change is the same
width. This is tricky if the <code>V1</code> data contained any negative numbers. So
this should be done with care.</p>
</div>
<div class="tabbed-block">
<p>Lets change the default values of the existing fields.</p>
<div class="highlight"><span class="filename">Schema V2</span><pre><span></span><code><span class="n">table</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">a</span><span class="p">:</span><span class="kt">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="nl">b</span><span class="p">:</span><span class="kt">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>This is NOT OK. Any <code>V1</code> data that did not have a value written to the
buffer relied on generated code to provide the default value.</p>
<p>There MAY be cases where this is OK, if you control all the producers and
consumers, and you can update them in tandem.</p>
</div>
<div class="tabbed-block">
<p>Lets change the name of the fields</p>
<div class="highlight"><span class="filename">Schema V2</span><pre><span></span><code><span class="n">table</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">aa</span><span class="p">:</span><span class="kt">int</span><span class="p">;</span>
<span class="w">  </span><span class="nl">bb</span><span class="p">:</span><span class="kt">int</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>This is generally OK. You've renamed fields will break all code and JSON
files that use this schema, but you can refactor those without affecting the
binary data, since the binary only address fields by id and offset, not by
names.</p>
</div>
</div>
</div>
<h3 id="union-evolution">Union Evolution</h3>
<p>Lets start with a simple union <code>U</code> with two members.</p>
<div class="highlight"><span class="filename">Schema V1</span><pre><span></span><code><span class="k">union</span><span class="w"> </span><span class="nc">U</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">A</span><span class="p">,</span>
<span class="w">  </span><span class="n">B</span>
<span class="p">}</span>
</code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="2:3"><input checked="checked" id="well-evolved_1" name="__tabbed_2" type="radio" /><input id="improper-evolved" name="__tabbed_2" type="radio" /><input id="evolved-with-discriminant" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="well-evolved_1">Well Evolved</label><label for="improper-evolved">Improper Evolved</label><label for="evolved-with-discriminant">Evolved With Discriminant</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Lets add a another variant to the end.</p>
<div class="highlight"><span class="filename">Schema V2</span><pre><span></span><code><span class="k">union</span><span class="w"> </span><span class="nc">U</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">A</span><span class="p">,</span>
<span class="w">  </span><span class="n">B</span><span class="p">,</span>
<span class="w">  </span><span class="nl">another_a</span><span class="p">:</span><span class="w"> </span><span class="n">A</span>
<span class="p">}</span>
</code></pre></div>
<p>This is OK. <code>CodeV1</code> will not recognize the <code>another_a</code>.</p>
</div>
<div class="tabbed-block">
<p>Lets add a another variant to the middle.</p>
<div class="highlight"><span class="filename">Schema V2</span><pre><span></span><code><span class="k">union</span><span class="w"> </span><span class="nc">U</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">A</span><span class="p">,</span>
<span class="w">  </span><span class="nl">another_a</span><span class="p">:</span><span class="w"> </span><span class="n">A</span><span class="p">,</span>
<span class="w">  </span><span class="n">B</span>
<span class="p">}</span>
</code></pre></div>
<p>This is NOT OK. <code>CodeV1</code> reading <code>V2</code> data will interpret <code>B</code> as <code>another_a</code>.
<code>CodeV2</code> reading <code>V1</code> data will interpret <code>another_a</code> as <code>B</code>.</p>
</div>
<div class="tabbed-block">
<p>Lets add a another variant to the middle, this time adding a union "discriminant".</p>
<div class="highlight"><span class="filename">Schema V2</span><pre><span></span><code><span class="k">union</span><span class="w"> </span><span class="nc">U</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nl">another_a</span><span class="p">:</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">  </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="p">}</span>
</code></pre></div>
<p>This is OK. Its like you added it to the end, but using the discriminant
value to physically place it elsewhere in the union.</p>
</div>
</div>
</div>
<h2 id="version-control">Version Control</h2>
<p>FlatBuffers relies on new field declarations being added at the end, and earlier
declarations to not be removed, but be marked deprecated when needed. We think
this is an improvement over the manual number assignment that happens in
Protocol Buffers (and which is still an option using the <code>id</code> attribute
mentioned above).</p>
<p>One place where this is possibly problematic however is source control. If user
<code>A</code> adds a field, generates new binary data with this new schema, then tries to
commit both to source control after user <code>B</code> already committed a new field also,
and just auto-merges the schema, the binary files are now invalid compared to
the new schema.</p>
<p>The solution of course is that you should not be generating binary data before
your schema changes have been committed, ensuring consistency with the rest of
the world. If this is not practical for you, use explicit field <code>id</code>s, which
should always generate a merge conflict if two people try to allocate the same
id.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "content.tabs.link", "navigation.expand"], "search": "../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.56dfad97.min.js"></script>
      
    
  </body>
</html>